<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Browser - Navegador con Capa IA</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .toolbar {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: #fff;
            border-bottom: 1px solid #ddd;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .url-bar {
            flex: 1;
            display: flex;
            align-items: center;
            margin: 0 12px;
        }

        .url-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.2s;
        }

        .url-input:focus {
            border-color: #2196f3;
        }

        .nav-button, .action-button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 8px;
            transition: background-color 0.2s;
        }

        .nav-button:hover, .action-button:hover {
            background: #1976d2;
        }

        .nav-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            margin-left: 12px;
            font-size: 12px;
            color: #666;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .status-connected {
            background: #4caf50;
        }

        .status-disconnected {
            background: #f44336;
        }

        .ai-status {
            position: fixed;
            top: 60px;
            right: 12px;
            background: rgba(33, 33, 33, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            z-index: 100;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
        }

        .content-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div class="toolbar">
        <div class="url-bar">
            <input type="text" class="url-input" id="urlInput" placeholder="Introduce una URL..." value="https://google.com">
            <button class="nav-button" id="goButton">Ir</button>
        </div>
        <button class="action-button" id="captureButton">üì∏ Capturar</button>
        <button class="action-button" id="analyzeButton">üîç Analizar</button>
        <button class="action-button" id="clearOverlayButton">üßπ Limpiar</button>
        <div class="status-indicator">
            <div class="status-dot status-disconnected" id="connectionStatus"></div>
            <span id="connectionText">Desconectado</span>
        </div>
    </div>

    <div class="content-container">
        <!-- El contenido web se cargar√° aqu√≠ -->
    </div>

    <div class="ai-status" id="aiStatus">IA Analizando...</div>

    <script>
        const { ipcRenderer } = require('electron');

        // Elementos del DOM
        const urlInput = document.getElementById('urlInput');
        const goButton = document.getElementById('goButton');
        const captureButton = document.getElementById('captureButton');
        const analyzeButton = document.getElementById('analyzeButton');
        const clearOverlayButton = document.getElementById('clearOverlayButton');
        const connectionStatus = document.getElementById('connectionStatus');
        const connectionText = document.getElementById('connectionText');
        const aiStatus = document.getElementById('aiStatus');

        // Navegaci√≥n
        function navigate(url) {
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }

            urlInput.value = url;

            // Enviar comando de navegaci√≥n al proceso principal
            if (window.electronAPI && window.electronAPI.sendCommand) {
                window.electronAPI.sendCommand({
                    action: 'navigate',
                    url: url
                });
            }
        }

        // Event listeners
        goButton.addEventListener('click', () => {
            navigate(urlInput.value.trim());
        });

        urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                navigate(urlInput.value.trim());
            }
        });

        captureButton.addEventListener('click', async () => {
            aiStatus.style.display = 'block';
            aiStatus.textContent = 'üì∏ Capturando pantalla...';

            try {
                await ipcRenderer.invoke('request-screenshot');
                setTimeout(() => {
                    aiStatus.style.display = 'none';
                }, 2000);
            } catch (error) {
                console.error('Error capturando pantalla:', error);
                aiStatus.textContent = '‚ùå Error al capturar';
                setTimeout(() => {
                    aiStatus.style.display = 'none';
                }, 2000);
            }
        });

        analyzeButton.addEventListener('click', async () => {
            aiStatus.style.display = 'block';
            aiStatus.textContent = 'üîç Analizando p√°gina...';

            try {
                await ipcRenderer.invoke('request-dom-analysis');
                setTimeout(() => {
                    aiStatus.style.display = 'none';
                }, 2000);
            } catch (error) {
                console.error('Error analizando p√°gina:', error);
                aiStatus.textContent = '‚ùå Error al analizar';
                setTimeout(() => {
                    aiStatus.style.display = 'none';
                }, 2000);
            }
        });

        clearOverlayButton.addEventListener('click', () => {
            // Enviar comando de limpiar overlay al proceso principal
            if (window.electronAPI && window.electronAPI.sendCommand) {
                window.electronAPI.sendCommand({
                    action: 'clear_overlay'
                });
            }
        });

        // Comandos desde el proceso principal (IA)
        if (window.electronAPI && window.electronAPI.onAICommand) {
            window.electronAPI.onAICommand((command) => {
                console.log('Comando IA recibido:', command);
                // Aqu√≠ se procesar√≠an los comandos de overlay
            });
        }

        // Actualizar estado de conexi√≥n
        setInterval(async () => {
            try {
                const browserInfo = await ipcRenderer.invoke('get-browser-info');
                connectionStatus.className = 'status-dot status-connected';
                connectionText.textContent = 'Conectado';
                urlInput.value = browserInfo.url;
            } catch (error) {
                connectionStatus.className = 'status-dot status-disconnected';
                connectionText.textContent = 'Desconectado';
            }
        }, 2000);

        console.log('Interfaz del navegador cargada');
    </script>
</body>
</html>